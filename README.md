# MDImageEmbed

Markdown 图片内嵌工具 - 将 Markdown 文件中的图片链接转换为 base64 内嵌格式

## 功能特性

- 读取本地 Markdown 文件，将图片转换为 base64 内嵌格式
- 提供图形界面进行文件选择、编辑和预览
- 支持编辑、保存、还原等操作
- 实时预览 Markdown 渲染效果（GitHub 风格）
- 支持多种图片格式：PNG, JPG, JPEG, GIF, WebP, SVG, BMP

## 界面布局

```
┌───────────────────────────────────────────────────────────┐
│  [选择文件] input.md                                       │
├───────────────────────────────────────────────────────────┤
│  [转换] [复制] [覆盖] [另存为] [还原]                      │
├────────────────────────┬──────────────────────────────────┤
│                        │                                  │
│   左侧：编辑区          │    右侧：预览区                   │
│                        │                                  │
│  可编辑的文本框         │   Markdown 渲染预览               │
│  显示 Markdown 内容    │   实时显示渲染效果                │
│                        │                                  │
│  用户可手动编辑         │   同步更新预览                    │
│                        │                                  │
└────────────────────────┴──────────────────────────────────┘
```

## 安装说明

### 1. 创建 Conda 环境

```bash
# 创建新的 conda 环境
conda create -n MDImageEmbed python=3.10

# 激活环境
conda activate MDImageEmbed
```

### 2. 安装依赖

```bash
# 进入项目目录
cd MDImageEmbed

# 安装所需依赖
pip install -r requirements.txt
```

### 依赖包说明

- `PyQt6` - GUI 框架
- `PyQt6-WebEngine` - 网页渲染引擎（用于预览）
- `markdown2` - Markdown 到 HTML 转换
- `Pillow` - 图片处理
- `pyperclip` - 剪贴板操作

## 使用方法

### 启动程序

```bash
# 确保已激活 conda 环境
conda activate MDImageEmbed

# 运行程序
python Main.py
```

### 操作流程

1. **选择文件**
   - 点击"选择文件"按钮
   - 选择要处理的 Markdown 文件
   - 文件内容将显示在左侧编辑区，右侧显示预览

2. **转换图片**
   - 点击"转换"按钮
   - 自动扫描所有本地图片引用
   - 将图片转换为 base64 内嵌格式
   - 显示转换日志（成功/失败）

3. **编辑内容**
   - 在左侧编辑区直接修改内容
   - 右侧预览会自动更新（延迟 500ms）

4. **保存文件**
   - **复制**：复制编辑区内容到剪贴板
   - **覆盖**：保存并覆盖原文件（需确认）
   - **另存为**：保存为新文件

5. **还原修改**
   - 点击"还原"按钮
   - 放弃所有修改，恢复到原始内容

## 功能说明

### 图片转换规则

- 仅转换本地图片文件（不转换网络链接）
- 跳过已经是 base64 格式的图片
- 支持相对路径和绝对路径
- 相对路径相对于 Markdown 文件所在目录

### 支持的图片格式

- PNG (`.png`)
- JPEG (`.jpg`, `.jpeg`)
- GIF (`.gif`)
- WebP (`.webp`)
- SVG (`.svg`)
- BMP (`.bmp`)

### 错误处理

- 图片文件不存在：跳过该图片，继续处理其他图片
- 图片格式不支持：跳过该图片，记录警告
- 文件读写权限：显示错误对话框
- Base64 编码失败：跳过该图片，继续处理

## 项目结构

```
MDImageEmbed/
├── Main.py                  # 主入口文件
├── Source/                  # 源码目录
│   ├── Logic/              # 业务逻辑层
│   │   ├── ImageConverter.py    # 图片转换器
│   │   └── FileUtils.py         # 文件工具
│   └── UI/                 # 界面层
│       ├── MainWindow.py        # 主窗口
│       └── assets/              # UI资源
│           └── style.css        # 预览样式
├── requirements.txt         # 依赖列表
├── README.md                # 说明文档
└── .gitignore               # Git 忽略配置
```

## 技术栈

- **GUI 框架**: PyQt6
- **Web 引擎**: PyQt6-WebEngine (QWebEngineView)
- **Markdown 渲染**: markdown2
- **图片处理**: Pillow
- **剪贴板**: pyperclip

## 注意事项

1. **图片大小**
   - base64 编码会增加约 33% 的文件大小
   - 大量或大尺寸图片可能导致 Markdown 文件过大

2. **兼容性**
   - 生成的 base64 图片在所有 Markdown 渲染器中都能显示
   - 适合需要单文件分发的场景

3. **性能**
   - 预览更新有 500ms 延迟，避免频繁刷新
   - 大文件可能导致预览渲染较慢

4. **文件编码**
   - 所有文件使用 UTF-8 编码
   - 确保 Markdown 文件使用 UTF-8 编码

## 常见问题

### Q: 为什么某些图片没有转换？

A: 可能的原因：
- 图片文件不存在或路径错误
- 图片格式不支持
- 图片已经是 base64 格式
- 图片是网络链接（http/https）

### Q: 转换后文件很大怎么办？

A: base64 编码会增加文件大小，可以：
- 选择性转换部分图片
- 压缩图片后再转换
- 考虑是否真的需要内嵌所有图片

### Q: 预览和实际渲染效果不一样？

A: 不同的 Markdown 渲染器可能有不同的样式，但 base64 图片本身是通用的。

## 开发信息

- **版本**: 1.0.0
- **Python 版本**: 3.10+
- **许可**: MIT

## 更新日志

### v1.0.0 (2025-10-14)
- 初始版本
- 基本的图片转 base64 功能
- GUI 界面实现
- 实时预览功能
- 编辑和保存功能

## 贡献

欢迎提交 Issue 和 Pull Request！

## 许可证

MIT License
